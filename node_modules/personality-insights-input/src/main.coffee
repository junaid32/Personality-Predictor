tweetParentId = (tweet) ->
  if tweet.in_reply_to_screen_name?
    tweet.in_reply_to_user_id
  else if tweet.retweeted and tweet.current_user_retweet?
    tweet.current_user_retweet.id_str

fromTweet = (tweet) ->
  id: tweet.id_str
  userid: tweet.user.id_str
  sourceid: 'twitter'
  language: tweet.lang
  contenttype: 'text/plain'
  content: tweet.text.replace '[^(\\x20-\\x7F)]*', ''
  created: Date.parse tweet.created_at
  forward: tweet.retweeted
  reply: tweet.in_reply_to_screen_name?
  parentid: tweetParentId tweet

fromTweets = (tweets) -> contentItems (tweets.map fromTweet)

contentItems = (items) -> contentItems : items

fromText = (metadata, text, id) ->
  id: id
  userid: metadata.userid
  sourceid: metadata.sourceid || 'generic'
  language: metadata.language
  contenttype: 'text/plain'
  content: text
  created: metadata.created

fromTexts = (texts, metadata={}) -> contentItems (texts.map (fromText.bind undefined, metadata))


# Public API Methods
module.exports =
  fromTweets : fromTweets
  fromTexts  : fromTexts
